!function(){var e,t,i,s,n=(e=[],t=[],i={},(s=function(s){if(void 0!==e[s])return e[s].exports;if(i={id:s,filename:s,parent:i,children:[],exports:{},loaded:!1},void 0===t[s])throw new Error("The factory of "+s+" module not found");return e[s]=t[s](n,i.exports,i,"undefined"!=typeof window?window:"undefined"!=typeof global?global:null),e[s].loaded=!0,e[s].parent.children&&e[s].parent.children.push(e[s]),e[s].exports}).def=function(e,i){t[e]=i},s);"undefined"==typeof require&&(require=n),n.def("build/main.js",(function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("build/canvas/canvas_util.js"),o=e("build/editor/editor.js"),r=e("build/player/player.js");let a,d,l,h,u="violins-against-aliens",g=!1,m=null,c=null,p=[];function f(){window.onclick=null,window.ontouchstart=null;let e=window.location.search.substring(1).split("&");for(let t of e)"projectpath"==t.split("=")[0]&&(u=t.split("=")[1],S("Requested projectpath: "+u));h=document.getElementById("video"),S("Init player...",!0),m=new r.Player,m.init(),m.addEventListener(r.Player.EVENT_PLAYBACK_READY,(()=>{!function(){S("Playback ready!",!0);let e=document.body.innerHTML;e=e.replace("{{ project.info.title }}",m.project.info.title).replace("{{ project.info.description }}",m.project.info.description).replace("{{ project.info.composer }}",m.project.info.composer).replace("{{ project.info.copyright }}",m.project.info.copyright),document.body.innerHTML=e,a=document.getElementById("content"),d=document.getElementById("log");let t=document.getElementById("buttons");t||(t=document.createElement("div"),t.id="buttons-general",t.className="buttons",a.insertBefore(t,a.children[0]));let i=document.createElement("button");i.id="playButton",i.className="button",i.innerHTML="Start",i.onclick=()=>{m.start()},t.appendChild(i);let s=document.createElement("button");s.id="stopButton",s.className="button",s.innerHTML="Stop",s.onclick=()=>{m.stop()},t.appendChild(s),t=document.createElement("div"),t.id="buttons-triggers",t.className="buttons",a.insertBefore(t,a.children[1]);for(let e of m.project.triggers){let i=document.createElement("button");i.id="trigger_"+e.name,i.innerHTML=e.description,i.onclick=()=>{if(m.trigger(e.name),e.next)for(let e of m.project.triggers)v("trigger_"+e.name,!0)},t.appendChild(i),v(i.id,!0)}let n=document.getElementById("sliderDiv");n||(n=document.createElement("div"),n.id="sliderDiv",a.insertBefore(n,a.children[2]));n&&(n.style.visibility="visible");for(let e of m.project.parameters){let t=document.createElement("div");t.id="parameter_"+e.name,t.className="parameterDiv",n.appendChild(t);let i=document.createElement("div");i.id=e.name+"Label",i.innerHTML=e.description+":",t.appendChild(i);let s=document.createElement("div");s.className="slidecontainer",t.appendChild(s);let o=document.createElement("input");o.type="range",o.className="slider",o.id=e.name,o.min=e.min.toString(),o.max=e.max.toString(),o.value=e.default.toString(),s.appendChild(o),o.oninput=function(){let t=parseFloat(o.value);m&&m.updateParameter(e.name,t)},p.push(o)}if(g){l=document.createElement("div"),l.id="graphDiv",a.insertBefore(l,a.children[0]);let e=document.createElement("canvas");e.id="editCanvas",l.appendChild(e),c=new o.Editor(m,e)}}()})),m.addEventListener(r.Player.EVENT_PLAYBACK_STARTED,(()=>{console.log("[main] onPlaybackStarted"),v("playButton",!0),v("stopButton",!1),v("outroButton",!1),window.requestAnimationFrame(y)})),m.addEventListener(r.Player.EVENT_SEGMENT_STARTED,(()=>{!function(){S("Segment started");for(let e of m.project.triggers){let t=m.isTriggerActive(e.name);v("trigger_"+e.name,!t)}h&&(m.currentSegment.video?(h.src=m.currentSegment.video,h.load(),h.play(),h.style.visibility="visible"):(h.pause(),h.style.visibility="hidden"))}()})),m.addEventListener(r.Player.EVENT_PLAYBACK_STOPPED,(()=>{!function(){h&&h.pause();S("no segment playing",!0),v("playButton",!1),v("stopButton",!0);for(let e of m.project.triggers)v("trigger_"+e.name,!0)}()})),m.loadProject("projects/"+u)}function y(e){let t=m.getPlayState(),i=m.currentSegmentEndTime-m.lastSegmentStartTime,s=m.context.currentTime-m.lastSegmentStartTime,o=s/i,r="";m.isPlaying&&(r=" ("+s.toFixed(2)+" / "+i.toFixed(2)+")");let a="current Segment: "+m.currentSegment.name+r+"<br/>";m.isPlaying&&(d.innerHTML=a);let l=document.getElementById("canvas"),h=l.getContext("2d"),u=10,p=300,f=50;m.currentSegment.next||m.nextQueuedSegmentName?n.CanvasUtil.setCanvasSize(l,670):n.CanvasUtil.setCanvasSize(l,320),n.CanvasUtil.clearCanvas(h),m.isPlaying&&(n.CanvasUtil.drawSegment(h,m.currentSegment,o,u,u,p,f),m.currentSegment.next&&(n.CanvasUtil.drawArrow(h,310,35,360,35,m.nextQueuedSegmentName?"#AAAAAA":"#FFFFFF"),n.CanvasUtil.drawSegment(h,m.getNextSegment(m.currentSegment),-1,360,u,p,f,!0,!0)),m.nextQueuedSegmentName&&(n.CanvasUtil.drawArrow(h,310,35,358,90,"#FFFFFF"),n.CanvasUtil.drawSegment(h,m.getSegmentForName(m.nextQueuedSegmentName),-1,360,65,p,f,!0,!0,!0))),g&&c.updatePlayState(t),m.isPlaying&&window.requestAnimationFrame(y)}function v(e,t){let i=document.getElementById(e);typeof i==typeof HTMLButtonElement&&(i.disabled=t)}function S(e,t=!1){d&&(t&&(d.innerHTML=""),d.innerHTML+=e.replace(/ /g,"&nbsp;")+"<br/>",console.log("[main] "+e))}return window.addEventListener("load",(function(){g=-1!=window.location.search.substr(1).indexOf("edit=true"),g&&console.log("Edit mode enabled!")})),window.onclick=()=>{f()},window.ontouchstart=()=>{f()},i})),n.def("build/canvas/canvas_util.js",(function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasUtil=void 0;return t.CanvasUtil=class{static setCanvasSize(e,t,i){e.style.width=t.toString(),i&&(e.style.height=i.toString()),e.width=e.offsetWidth,e.height=e.offsetHeight}static clearCanvas(e,t="#003F00"){e.fillStyle=t,e.fillRect(0,0,e.canvas.clientWidth,e.canvas.clientHeight)}static drawSegment(e,t,i,s,n,o,r,a=!1,d=!1,l=!1,h=null){if(!t)return void console.log("ERROR: Can't draw undefined segment!");s||(s=0),n||(n=0),o||(o=400),r||(r=50);let u="#AAAAAA",g="#007F00";if(d&&(u="#FFFFFF",g="#009F00"),e.fillStyle=u,e.strokeStyle=g,h&&(e.strokeStyle=h,e.lineWidth=2),this.roundRect(e,s,n,o,r,10,!0),l){let t=127*(Math.sin(.005*(new Date).getMilliseconds())+1),i=parseInt(t.toFixed(0)).toString(16);for(;i.length<2;)i="0"+i;let a="#00FF00"+i;e.lineWidth=2,e.strokeStyle=a,this.roundRect(e,s,n,o,r,10,!1)}e.strokeStyle=g,e.fillStyle=g,-1!=i&&(e.lineWidth=2,e.beginPath(),e.moveTo(s+i*o,n),e.lineTo(s+i*o,n+r),e.stroke()),e.font="12pt Orbitron",e.fillText(t.name.replace("_master",""),s+10,n+.4*r)}static drawArrow(e,t,i,s,n,o,r=!1,a=0,d=0){if(e.strokeStyle=o,e.fillStyle=o,e.lineWidth=2,s-t>a){e.beginPath(),e.moveTo(t,i);let o=t+(s-t)/2;e.bezierCurveTo(o,i,o,n,s-(r?0:10),n),e.stroke()}else{let o=n>=i?1:-1,a={x:t+d/2,y:i},l={x:t+d/2,y:i+d*o},h={x:t,y:i+d*o},u={x:s,y:i+d*o},g={x:s-Math.abs(n-u.y)/2,y:i+d*o},m={x:s-Math.abs(n-u.y)/2,y:n};e.beginPath(),e.moveTo(t,i),e.bezierCurveTo(a.x,a.y,l.x,l.y,h.x,h.y),e.lineTo(u.x,u.y),e.bezierCurveTo(g.x,g.y,m.x,m.y,s-(r?0:10),n),e.stroke()}r||(e.lineWidth=1,e.beginPath(),e.moveTo(s,n),e.lineTo(s-10,n-5),e.lineTo(s-10,n+5),e.lineTo(s,n),e.fill(),e.stroke())}static roundRect(e,t,i,s,n,o,r=!0,a=!1,d=!1){s<2*o&&(o=s/2),n<2*o&&(o=n/2);let l=a?0:o,h=d?0:o;return e.beginPath(),e.moveTo(t+l,i),e.arcTo(t+s,i,t+s,i+n,h),e.arcTo(t+s,i+n,t,i+n,h),e.arcTo(t,i+n,t,i,l),e.arcTo(t,i,t+s,i,l),e.closePath(),r&&e.fill(),e.stroke(),e}},i.exports=t,i})),n.def("build/editor/editor.js",(function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Editor=void 0;const n=e("build/model/project.js"),o=e("build/util/util.js"),r=e("build/editor/editor_node_graph.js");t.Editor=class{constructor(e,t){this.editMouseMovedEnoughToNotBeClick=5,this.player=e,this.project=this.player.project,this.editCanvas=t,this.editCanvasContext=t.getContext("2d"),this.editNodeGraph=new r.EditorNodeGraph(t,"100%",400),this.editNodeGraph.nodeWidth=200,this.editKeyMappings=[{key:"l",description:"Reload edit canvas",handler:()=>{this.reloadEditCanvas()}},{key:"escape",description:"Reset modifiers",handler:()=>{this.resetEditModifiers()}},{key:"r",description:"Reset transform",handler:()=>{this.editNodeGraph.resetEditCanvasTransform()}}],this.editMousePos={x:0,y:0},this.editMouseMovedEnoughToNotBeClick=5,this.editMouseMoveDistance=0,this.dragStartNode=null,this.dragStartYOffset=0,this.dragArrowColor="white",this.dragMoveNode=null,this.dragMoveGroup=null,this.dragMouseOffsetInNode=null,this.dragGroupRect=null,this.initInteraction(),this.reloadEditCanvas(),this.editNodeGraph.updateEditCanvas(null,this._cachedPlayState,this.editState)}initInteraction(){this.editCanvas.onmousedown=e=>{this.editCanvas_OnMouseDown(e)},this.editCanvas.onmousemove=e=>{this.editCanvas_OnMouseMove(e)},this.editCanvas.onmouseup=e=>{this.editCanvas_OnMouseUp(e)},this.editCanvas.ondblclick=e=>{this.editCanvas_OnDoubleClick(e)},this.editCanvas.onwheel=e=>{this.editCanvas_OnMouseWheel(e)},window.onkeydown=e=>{this.editCanvas_OnKeyDown(e)},this.editCanvas.ondragover=e=>{this.editCanvas_onDragOver(e)},this.editCanvas.ondrop=e=>{this.editCanvas_onDrop(e)}}reloadEditCanvas(){this.editNodeGraph.clearNodes();for(let e of this.project.segments)e.type!=n.SegmentType.LAYER&&this.editNodeGraph.addNode(e)}editCanvas_onDragOver(e){e.preventDefault()}editCanvas_onDrop(e){if(e.preventDefault(),console.log("** Drop: "+JSON.stringify(e)),e.dataTransfer.items){this._filesToLoad=[];for(let t=0;t<e.dataTransfer.items.length;t++){let i=e.dataTransfer.items[t].getAsFile();console.log("**   File: "+i.name);let s=this.player.soundBank.getSoundByFile(i.name,!1);s?(console.log("Found sound in SoundBank: "+s.name),this.addSoundFromSoundBank(s)):(console.log("File not in soundBank, add to load list"),this._filesToLoad.push(i))}this._filesToLoad.length>0&&(console.log("*** Test adding files from project folder to project"),this.player.addSoundsFromFiles(this._filesToLoad.map((e=>e.name)),(e=>{this.onFilesLoaded(e)})))}}addSoundFromSoundBank(e){let t=this.project.segments.find((t=>{t.file,e.path}));if(t)console.log("Found segment for sound in Project: "+t.name),this.editNodeGraph.addNode(t,this.editMousePos.x,this.editMousePos.y);else{let t=new n.Segment;t.name=e.name,t.file=e.path,t.type=t.name.indexOf("stinger")>-1?n.SegmentType.STINGER:t.name.indexOf("outro")>-1?n.SegmentType.OUTRO:n.SegmentType.SEGMENT,this.project.segments.push(t),this.editNodeGraph.addNode(t,this.editMousePos.x,this.editMousePos.y),console.log("Added segment: "+t.name)}}onFilesLoaded(e){for(let e of this._filesToLoad){let t=this.player.soundBank.getSoundByFile(e.name,!1);t?(console.log("Found sound in SoundBank: "+t.name),this.addSoundFromSoundBank(t)):console.log("ERROR: Could not add loaded sound from file "+e.name)}}updatePlayState(e){this._cachedPlayState=e,this.editNodeGraph.updateEditCanvas(null,e,this.editState)}editCanvas_OnMouseWheel(e){let t=1+.1*Math.abs(e.deltaY)/e.deltaY;return this.editNodeGraph.zoomBy(t,e),e.preventDefault(),!1}editCanvas_OnKeyDown(e){console.log(e.key);for(let t of this.editKeyMappings)e.key===t.key&&t.handler()}editCanvas_OnMouseDown(e){console.log("edit mouse down: "+e),this.editMouseMoveDistance=0;let t=this.findNodeUnderMouse(),i=this.findGroupUnderMouse();if(t){if(t.widgets)for(let e of t.widgets)if(this.isEditMouseOverRect(o.Util.localBounds(e,t)))return void("next"==e.name?(this.dragStartNode=t,this.dragStartYOffset=0,this.dragArrowColor="stinger"==t.segment.type?"yellow":"white"):"outro"==e.name&&(this.dragStartNode=t,this.dragStartYOffset=15,this.dragArrowColor="red"));this.dragMoveNode=t,this.editMousePos=this.editNodeGraph.getEditMousePos(e),this.dragMouseOffsetInNode={x:this.editMousePos.x/this.editNodeGraph.editCanvasScale-t.x,y:this.editMousePos.y/this.editNodeGraph.editCanvasScale-t.y}}else if(i)this.dragMoveGroup=i,this.editMousePos=this.editNodeGraph.getEditMousePos(e),this.dragMouseOffsetInNode={x:this.editMousePos.x/this.editNodeGraph.editCanvasScale-i.x,y:this.editMousePos.y/this.editNodeGraph.editCanvasScale-i.y};else if(e.ctrlKey){let t=this.editNodeGraph.getEditMousePos(e);t=o.Util.scalePointBy(this.globalToLocal(t),1/this.editNodeGraph.editCanvasScale),this.dragGroupRect=new o.Rectangle(t.x,t.y)}}editCanvas_OnMouseMove(e){if(this.editMousePos=this.editNodeGraph.getEditMousePos(e),this.editMouseMoveDistance+=Math.abs(e.movementX)+Math.abs(e.movementY),this.dragStartNode);else if(this.dragMoveNode)this.dragMoveNode.x=this.editMousePos.x/this.editNodeGraph.editCanvasScale-this.dragMouseOffsetInNode.x,this.dragMoveNode.y=this.editMousePos.y/this.editNodeGraph.editCanvasScale-this.dragMouseOffsetInNode.y;else if(this.dragMoveGroup){let e={x:this.dragMoveGroup.x,y:this.dragMoveGroup.y};this.dragMoveGroup.x=this.editMousePos.x/this.editNodeGraph.editCanvasScale-this.dragMouseOffsetInNode.x,this.dragMoveGroup.y=this.editMousePos.y/this.editNodeGraph.editCanvasScale-this.dragMouseOffsetInNode.y;let t=o.Util.subPoints({x:this.dragMoveGroup.x,y:this.dragMoveGroup.y},e);for(let e of this.dragMoveGroup.nodes)e.x+=t.x,e.y+=t.y}else if(e.buttons>0)if(this.dragGroupRect){let e=this.globalToLocal(this.editMousePos);this.dragGroupRect.width=e.x/this.editNodeGraph.editCanvasScale-this.dragGroupRect.x,this.dragGroupRect.height=e.y/this.editNodeGraph.editCanvasScale-this.dragGroupRect.y}else this.editNodeGraph.editCanvasOffset.x+=e.movementX/this.editNodeGraph.editCanvasScale,this.editNodeGraph.editCanvasOffset.y+=e.movementY/this.editNodeGraph.editCanvasScale;this.updateEditState()}editCanvas_OnMouseUp(e){console.log("edit mouse up"),this.dragGroupRect?this.createNodeGroup(o.Util.normalizeRect(this.dragGroupRect)):this.dragMoveNode?this.editMouseMoveDistance<this.editMouseMovedEnoughToNotBeClick&&(this.activeEditNode=this.dragMoveNode,this.updateEditState()):this.editMouseMoveDistance<this.editMouseMovedEnoughToNotBeClick?this.handleClick(e):this.handleConnectDragEnd(e),this.resetEditModifiers()}editCanvas_OnDoubleClick(e){let t=this.findNodeUnderMouse();if(t)return"stinger"==t.segment.type?(console.log("try to playStinger("+t.segment.name+", 0, false"),this.player.removeQueuedStingersAfter(0),this.player.playStinger(t.segment.name,0,!1)):this.player.playSegment(t.segment.name,0),e.stopImmediatePropagation(),void e.preventDefault();let i=this.findGroupUnderMouse();i&&(this.editNodeGraph.removeNodeGroup(i.name),this.editNodeGraph.updateEditCanvas(e,this._cachedPlayState,this.editState),e.stopImmediatePropagation(),e.preventDefault())}createNodeGroup(e){let t=this.editNodeGraph.nodes.filter((t=>o.Util.doRectsOverlap(this.editNodeGraph.getNodeBounds(t),e)));console.log("Group nodes: "+t.map((e=>e.segment.name)).join(",")),this.editNodeGraph.addNodeGroup("",t,e.x,e.y,e.width,e.height)}handleConnectDragEnd(e){if(!this.dragStartNode||!this.dragStartNode.segment)return;let t=this.findNodeUnderMouse();if(t){console.log("targetNode: "+t.segment.name);let i=!1;"stinger"==this.dragStartNode.segment.type?"stinger"!=t.segment.type&&(t.segment.stinger=this.dragStartNode.segment.name,i=!0):"outro"==t.segment.type?"outro"!=this.dragStartNode.segment.type&&(this.dragStartNode.segment.outro=t.segment.name,i=!0):"outro"!=this.dragStartNode.segment.type&&"stinger"!=t.segment.type&&(this.dragStartNode.segment.next=t.segment.name,i=!0),this.editNodeGraph.updateEditCanvas(e,this._cachedPlayState,this.editState)}}handleClick(e){console.log("edit mouse click");let t=this.findNodeUnderMouse();if(t){if(t.widgets)for(let e of t.widgets)if(this.isEditMouseOverRect(o.Util.localBounds(e,t)))return void this.handleNodeWidgetClick(t,e.name)}else this.activeEditNode=null,this.updateEditState()}handleNodeWidgetClick(e,t){switch(console.log("handle node widget click: "+e.segment.name+"."+t),t){case"delete":console.log("Delete segment node "+e.segment.name+"!"),this.deleteNode(e);break;case"stinger":console.log("Remove stinger link from "+e.segment.name+"!"),this.removeLink(e,"stinger");break;case"next":console.log("Remove next link from "+e.segment.name+"!"),this.removeLink(e,"next");break;case"outro":console.log("Remove outro link from "+e.segment.name+"!"),this.removeLink(e,"outro")}}deleteNode(e){this.editNodeGraph.removeNodeWithName(e.segment.name);let t=this.project.segments.indexOf(e.segment);t>-1&&this.project.segments.splice(t,1);for(let t of this.editNodeGraph.nodes)t.segment.next==e.segment.name&&(t.segment.next=""),t.segment.stinger==e.segment.name&&(t.segment.stinger=""),t.segment.outro==e.segment.name&&(t.segment.outro="");this.editNodeGraph.updateEditCanvas(null,this._cachedPlayState,this.editState)}removeLink(e,t){switch(t){case"next":e.segment.next="";break;case"stinger":e.segment.stinger="";break;case"outro":e.segment.outro="";break;default:return void console.log("WARNING: Can't remove link type "+t)}this.editNodeGraph.updateEditCanvas(null,this._cachedPlayState,this.editState)}resetEditModifiers(){this.dragStartNode=null,this.dragMoveNode=null,this.dragMoveGroup=null,this.dragGroupRect=null}updateEditState(){this.editState={activeEditNode:this.activeEditNode,dragStartNode:this.dragStartNode,dragGroupRect:this.dragGroupRect,dragStartYOffset:this.dragStartYOffset,dragArrowColor:this.dragArrowColor},this.editNodeGraph.updateEditCanvas(null,this._cachedPlayState,this.editState)}isEditMouseOver(e,t,i,s,n){return e.x/this.editNodeGraph.editCanvasScale-this.editNodeGraph.editCanvasOffset.x>t&&e.x/this.editNodeGraph.editCanvasScale-this.editNodeGraph.editCanvasOffset.x<t+s&&e.y/this.editNodeGraph.editCanvasScale-this.editNodeGraph.editCanvasOffset.y>i&&e.y/this.editNodeGraph.editCanvasScale-this.editNodeGraph.editCanvasOffset.y<i+n}isEditMouseOverRect(e){return this.isEditMouseOver(this.editMousePos,e.x,e.y,e.width,e.height)}findNodeUnderMouse(){var e,t;for(let i of this.editNodeGraph.nodes)if(this.isEditMouseOver(this.editMousePos,i.x,i.y,null!==(e=i.width)&&void 0!==e?e:this.editNodeGraph.nodeWidth,null!==(t=i.height)&&void 0!==t?t:this.editNodeGraph.nodeHeight))return i;return null}findGroupUnderMouse(){for(let e of this.editNodeGraph.nodeGroups)if(this.isEditMouseOver(this.editMousePos,e.x,e.y,e.width,e.height))return e;return null}globalToLocal(e){return o.Util.moveRectBy(e,o.Util.scalePointBy(this.editNodeGraph.editCanvasOffset,-1*this.editNodeGraph.editCanvasScale))}};return i.exports=t,i})),n.def("build/player/player.js",(function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;const n=e("build/sequencer/sound.js");class o extends EventTarget{constructor(e=null){super(),this.canPlayOgg="maybe",this.currentSegment=null,this.nextQueuedSegmentName=null,this.isPlaying=!1,this.lastSegmentStartTime=0,this.currentSegmentEndTime=0,this.nextSegmentEndTime=0,this.currentLayers=[],this.queuedStingers=[],this.project=null,this.projectFilename="project.json",this.segmentsFolder="sounds/",this.startSegment="",this.defaultOutro="",this.parameters={},this.logDiv=e}init(){this.log("Init...",!0);try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.MozAudioContext,this.context=new AudioContext,this.context.onstatechange=()=>{this.log("Audio context state changed: "+this.context.state)}}catch(e){alert("No audio support")}window.addEventListener("resume",(e=>{this.context&&this.context.resume()})),"running"!=this.context.state&&this.context.resume();let e=document.createElement("audio");this.canPlayOgg=e.canPlayType("audio/ogg"),e.remove()}loadProject(e){-1==e.indexOf(".json")&&(e=e.replace(new RegExp(/\/$/),"")+"/"+this.projectFilename),this.log("Loading project "+e+"...");var t=new XMLHttpRequest;t.onload=()=>{let i=t.response;i.info.basePath=e.substring(0,e.lastIndexOf("/")),this.initProject(i)},t.onerror=this.onError.bind(this),t.open("GET",e,!0),this.log("Opened request..."),t.responseType="json",t.send(),this.log("Sent request...")}initProject(e){this.project=e,console.log("project:"+JSON.stringify(e)),this.startSegment=e.interface.startSegment,this.defaultOutro=e.interface.defaultOutro,this.loadSegments(),this.parameters={};for(let e of this.project.parameters)this.parameters[e.name]={name:e.name,description:e.description,value:e.default,min:e.min,max:e.max,default:e.default}}loadSegments(){if(!this.project)return void this.log("ERROR: Need to set project first!");this.log("Loading segments for project "+this.project.info.name+"...");let e="ogg";this.canPlayOgg||(this.log("Can't play ogg, try mp3..."),e="mp3");let t=[];for(let e of this.project.segments)if(e.file&&this.queueFileForLoad(t,e.name,e.file),e.layers)for(let i of e.layers)i.file&&this.queueFileForLoad(t,e.name+"_"+i.name,i.file);this.soundBank=new n.SoundBank(this.context,this.log),console.log("---"+this.project.info.basePath),this.soundBank.loadSounds(t,this.project.info.basePath+"/"+this.segmentsFolder+e+"/",(e=>{this.onSoundsLoaded(e)}),this.onError.bind(this))}addSoundsFromFiles(e,t){console.log("*** Loading files: ***");for(let t of e)console.log("    "+t);if(0==e.length)return;let i=e[0].replace(/.*\./g,""),s=[];for(let t of e)s.push({name:t.replace(/\.[^.]*$/g,""),file:t});this.soundBank.loadSounds(s,this.project.info.basePath+"/"+this.segmentsFolder+i+"/",(e=>{t(e)}),this.onError.bind(this))}queueFileForLoad(e,t,i){this.canPlayOgg||(i=i.replace(".ogg",".mp3")),e.push({name:t,file:i})}onError(e){this.log("ERROR! "+e)}onSoundsLoaded(e){this.log("Sounds loaded."),this.dispatchEvent(new Event(o.EVENT_PLAYBACK_READY))}start(){this.playSegment(this.startSegment)}pause(){}outroOrStop(){let e=this.defaultOutro;this.currentSegment&&this.currentSegment.outro?e=this.currentSegment.outro:this.currentSegment&&"outro"==this.currentSegment.type&&(e=null),e?this.triggerOnNextBar(e):this.stop()}stop(){this.log("Stop."),this.clearLayers(),this.removeQueuedStingersAfter(),this.isPlaying=!1,this.dispatchEvent(new Event(o.EVENT_PLAYBACK_STOPPED))}trigger(e){let t=this.project.triggers.find((t=>t.name===e));if(t){if(this.log("trigger "+e),t.next){let e=-1;"immediate"==t.urgency&&(e=0),this.triggerOnNextBar(t.next,e)}if(t.stinger){let e=null;"immediate"==t.urgency&&(e=0),this.playStinger(t.stinger,e,!1)}}}updateParameter(e,t){if(this.parameters.hasOwnProperty(e)){this.parameters[e].value=t;let i=this.getParameter(e);this.log("Updated parameter "+e+" to "+t+" (relative: "+i+")");for(let t of this.getLayersForParameter(e))t.gain.gain.setValueAtTime(Math.min(i,1),this.context.currentTime)}else this.log("WARNING: Parameter "+e+" doesn't exist, so can't be updated! Create it first.")}getParameter(e){var t;return this.parameters.hasOwnProperty(e)?this.parameters[e].value/(null!==(t=this.parameters[e].max)&&void 0!==t?t:1):(this.log("WARNING: Parameter "+e+" doesn't exist! Returning 0."),0)}getPlayState(){let e=this.currentSegmentEndTime-this.lastSegmentStartTime,t=(this.context.currentTime-this.lastSegmentStartTime)/e,i=null,s=null;if(this.queuedStingers.length>0&&this.queuedStingers[0].startTime<this.context.currentTime){i=this.getSegmentForName(this.queuedStingers[0].name);let e=this.soundBank.getSound(i.name);if(e){let t=e.buffer.duration;s=(this.context.currentTime-this.queuedStingers[0].startTime)/t}else this.log("WARNING stinger soundElement not found: "+i.name),i=null,s=null}let n=this.getSegmentForName(this.nextQueuedSegmentName);return{isPlaying:this.isPlaying,currentSegments:[this.currentSegment,i],percentages:[t,s],nextQueuedSegment:n}}isTriggerActive(e){return!!(this.currentSegment.triggers_enabled&&this.currentSegment.triggers_enabled.indexOf(e)>-1)}playSegment(e,t){var i,s;if(t||(t=0),this.log("Play "+e+" in "+t+"..."),this.clearLayers(),this.currentSegment=this.getSegmentForName(e),this.currentSegment){for(let t of null!==(i=this.currentSegment.layers)&&void 0!==i?i:[{name:"base",segment:e,parameter:null}]){this.log("  Loading segment for layer "+t.name+": "+t.segment);let i=this.soundBank.getSound(null!==(s=t.segment)&&void 0!==s?s:e+"_"+t.name);i?this.currentLayers.push({name:t.name,soundElement:i,source:null,parameter:t.parameter,gain:null}):this.log("ERROR: No soundElement found for name: "+t.segment)}if(0!=this.currentLayers.length){for(let e of this.currentLayers)this.initAudioNodesForLayer(e),e.source&&e.source.start(t);this.currentLayers[0].source.onended=()=>{this.playNextSegment()},this.lastSegmentStartTime=this.context.currentTime+t,this.currentSegmentEndTime=this.context.currentTime+t+this.currentLayers[0].source.buffer.duration,this.nextSegmentEndTime=this.currentSegmentEndTime,this.log("lastSegmentStartTime: "+this.lastSegmentStartTime),this.log("nextSegmentEndTime: "+this.nextSegmentEndTime);var n=this.getNextSegment(this.currentSegment);n&&n.stinger&&this.playStinger(n.stinger,this.nextSegmentEndTime),this.isPlaying||(this.dispatchEvent(new Event(o.EVENT_PLAYBACK_STARTED)),this.isPlaying=!0),this.dispatchEvent(new Event(o.EVENT_SEGMENT_STARTED))}else this.log("ERROR: Found no sounds to play for segment: "+e)}else this.log("ERROR: No segment found for name: "+e)}initAudioNodesForLayer(e){let t=this.context.createBufferSource();t.buffer=e.soundElement.buffer,this.log("Created buffer source node for layer "+e.name);let i=this.context.createGain(),s=1;e.parameter&&(s=Math.min(1,this.getParameter(e.parameter))),i.gain.setValueAtTime(s,this.context.currentTime),this.log("Created gain node for layer "+e.name+"(parameter: "+e.parameter+")"),t.connect(i),i.connect(this.context.destination),e.source=t,e.gain=i}playNextSegment(){if(this.nextQueuedSegmentName)this.playSegment(this.nextQueuedSegmentName),this.nextQueuedSegmentName=null;else if(this.currentSegment){var e=this.getNextSegment(this.currentSegment);e?this.playSegment(e.name):this.outroOrStop()}else this.outroOrStop()}playStinger(e,t=-1,i=!0){var s,n,o;this.log("playStinger("+e+","+t+","+i+")"),i&&this.removeQueuedStingersAfter(this.context.currentTime);let r=this.getSegmentForName(e);if(!r)return void this.log("ERROR: Stinger segment not found: "+e);let a=[];for(let t of null!==(s=r.layers)&&void 0!==s?s:[{name:e,segment:e,parameter:null}]){let i=null!==(n=t.segment)&&void 0!==n?n:e+"_"+t.name;this.log("  Loading segment for layer "+t.name+": "+i);let s=this.soundBank.getSound(i);s?a.push({name:t.name,soundElement:s,source:null,parameter:t.parameter,gain:null}):this.log("ERROR: No soundElement found for name: "+t.segment)}if(0==a.length)return void this.log("ERROR: Found no sounds to play for segment: "+e);this.nextSegmentEndTime||(this.nextSegmentEndTime=0),this.log("nextSegmentEndTime:"+this.nextSegmentEndTime+", stingerSegment.startOffset:"+r.startOffset);let d=Math.max(0,(-1!=t?t:this.nextSegmentEndTime)-(null!==(o=r.startOffset)&&void 0!==o?o:0));this.log("stinger startTime: "+d);for(let e of a)this.log("Prepare stinger layer "+e.name),this.initAudioNodesForLayer(e),e.source&&(this.queuedStingers.push({name:e.name,source:e.source,startTime:d}),e.source.start(d))}removeQueuedStingersAfter(e=0){for(let t=0;t<this.queuedStingers.length;t++){let i=this.queuedStingers[t];this.log("queued stinger "+t+": "+i.name),this.log("  source: "+i.source),this.log("  startTime: "+i.startTime),i.source&&i.startTime>=e&&(this.log("Stopping stinger "+i.name+" ("+(t+1)+"/"+this.queuedStingers.length+")"),i.source.stop())}this.queuedStingers=[]}triggerOnNextBar(e,t=-1){this.nextQueuedSegmentName=e;let i=this.getSegmentForName(this.nextQueuedSegmentName);if(i){if(this.log("nextQueuedSegment: "+i.name),-1==t&&(t=0,i.stinger)){let e=this.getSegmentForName(i.stinger);e&&(t=e.startOffset)}if(this.log("safeTime: "+t),this.currentSegment.bars){let e=this.findNextBar(this.currentSegment,this.context.currentTime+t);if(this.log("nextBar: "+JSON.stringify(e)),e){this.nextSegmentEndTime=this.lastSegmentStartTime+e.offset;let t=this.nextSegmentEndTime-this.context.currentTime;this.log("switching in "+t+"...");for(let e of this.currentLayers)e.source.stop(this.nextSegmentEndTime)}}i.stinger&&this.nextSegmentEndTime-this.context.currentTime>t&&this.playStinger(i.stinger,this.nextSegmentEndTime)}}clearLayers(){for(let e of this.currentLayers)e.source?(this.log("Stopping layer "+e.name),e.source.onended=null,e.source.stop(),e.source.disconnect(),e.gain&&e.gain.disconnect()):this.log("WARNING: Can't stop layer "+e.name+", no source");this.currentLayers=[]}findNextBar(e,t){if(e!=this.currentSegment)return this.log("ERROR: findCurrentBar only works for currentSegment!"),null;if(e.bars){let i=null;for(let s=0;s<e.bars.length;s++){let n=e.bars[s];this.log("time: "+t+" - checking bar: "+n.number);let o=this.lastSegmentStartTime+n.offset;if(this.log("  (start: "+o+")"),t<o)return this.log("Found next bar!"),i=n,i}return null}return null}findCurrentBar(e,t){if(e!=this.currentSegment)return this.log("ERROR: findCurrentBar only works for currentSegment!"),null;if(e.bars){let i=null;for(let s=0;s<e.bars.length;s++){let n=e.bars[s],o=this.lastSegmentStartTime+n.offset,r=o+this.getBarDuration(e,n);if(t>o&&t<r)return i=n,i}return null}return null}getBarDuration(e,t){if(e!=this.currentSegment)return console.log("ERROR: findCurrentBar only works for currentSegment!"),0;let i=e.tempo,s=this.parseBeats(e.beat);return t.beat&&(s=this.parseBeats(t.beat)),t.tempo&&(i=t.tempo),parseFloat(s)*(60/i)}parseBeats(e){return e.substring(0,e.indexOf("/"))}parseBeatNotevalue(e){return e.substring(e.indexOf("/")+1)}getSegmentForName(e){return this.project.segments.find((t=>t.name===e))}getNextSegment(e=this.currentSegment){return e&&e.next?this.getSegmentForName(e.next):null}getOutro(e){return this.currentSegment&&this.currentSegment.outro?this.getSegmentForName(this.currentSegment.outro):null}getLayersForParameter(e){return this.currentLayers.filter((t=>t.parameter==e))}generateNameFromPath(e){return e.replace(/^.*\//g,"").replace(/\.[^.]*$/g,"")}log(e,t){this.logDiv&&(t&&(this.logDiv.innerHTML=""),this.logDiv.innerHTML+=e.replace(/ /g,"&nbsp;")+"<br/>"),console.log("[player] "+e)}}return t.Player=o,o.EVENT_PLAYBACK_READY="playback_ready",o.EVENT_PLAYBACK_STARTED="playback_started",o.EVENT_PLAYBACK_STOPPED="playback_stopped",o.EVENT_SEGMENT_STARTED="segment_started",i.exports=t,i})),n.def("build/model/project.js",(function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Parameter=t.Trigger=t.Bar=t.ParameterType=t.Layer=t.SegmentType=t.Segment=t.Project=void 0;t.Project=class{};t.Segment=class{},function(e){e.SEGMENT="segment",e.LAYER="layer",e.STINGER="stinger",e.OUTRO="outro"}(t.SegmentType||(t.SegmentType={}));t.Layer=class{},function(e){e.GAIN="gain",e.LOWPASS="lowpass",e.HIGHPASS="highpass",e.PAN="pan"}(t.ParameterType||(t.ParameterType={}));t.Bar=class{};t.Trigger=class{};return t.Parameter=class{},i.exports=t,i})),n.def("build/util/util.js",(function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Rectangle=t.Point2D=t.Util=void 0;t.Util=class{static addPoints(e,t){return{x:e.x+t.x,y:e.y+t.y}}static subPoints(e,t){return{x:e.x-t.x,y:e.y-t.y}}static scalePointBy(e,t){return{x:e.x*t,y:e.y*t}}static moveRectBy(e,t){return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height,left:e.left,right:e.right}}static normalizeRect(e){return{x:e.width>0?e.x:e.x+e.width,y:e.height>0?e.y:e.y+e.height,width:Math.abs(e.width),height:Math.abs(e.height)}}static doRectsOverlap(e,t){return t.x<e.x+e.width&&e.x<t.x+t.width&&t.y<e.y+e.height&&e.y<t.y+t.height}static localBounds(e,t){return this.moveRectBy(e.bounds,{x:t.x,y:t.y})}};t.Point2D=class{constructor(e=0,t=0){this.x=e,this.y=t}};return t.Rectangle=class{constructor(e=0,t=0,i=0,s=0,n=!1,o=!1){this.x=e,this.y=t,this.width=i,this.height=s,this.left=n,this.right=o}},i.exports=t,i})),n.def("build/editor/editor_node_graph.js",(function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditorNodeGroup=t.EditorNode=t.EditorNodeGraph=void 0;const n=e("build/canvas/canvas_util.js"),o=e("build/util/util.js");t.EditorNodeGraph=class{constructor(e,t,i,s=null){this.fitWidth=!0,this.fitHeight=!1,this.margin=30,this.nodeWidth=300,this.nodeHeight=50,this.nodeOffset=50,this.backgroundColor="#000000",this.nodes=[],this.nodeGroups=[],this.editCanvasScale=1,this.editCanvasOffset={x:0,y:0},this.editMousePos=null,this.editCanvas=e,this.editCanvasContext=this.editCanvas.getContext("2d"),this.width=t,this.fitWidth=-1==t,this.height=i,this.fitHeight=-1==i,this.backgroundColor=null!=s?s:"#000000",window.onresize=()=>{this.updateEditCanvas()}}clearNodes(){this.nodes=[],this.nodeGroups=[]}addNode(e,t,i){if(!this.getNodeByName(e.name)){let s=new r(e,null!=t?t:this.getXForNewSegmentType(e.type),null!=i?i:this.getYForNewSegmentType(e.type));return this.nodes.push(s),console.log("Added node for segment "+e.name+" at ("+s.x+","+s.y+")"),s}}removeNodeWithName(e){let t=this.getNodeByName(e);t&&(this.nodes.splice(this.nodes.indexOf(t),1),console.log("Removed node for segment: "+e))}getNodeByName(e){for(let t of this.nodes)if(t.segment.name==e)return t;return null}getXForNewSegmentType(e){var t;let i=this.margin;for(let s of this.nodes)s.segment.type==e&&s.x+this.nodeWidth>i&&(i=s.x+(null!==(t=s.width)&&void 0!==t?t:this.nodeWidth)+this.nodeOffset);return i}getYForNewSegmentType(e){switch(e){case"stinger":return this.margin;case"outro":return this.margin+2*(this.nodeHeight+this.nodeOffset);default:return this.margin+1*(this.nodeHeight+this.nodeOffset)}}getNodeBounds(e){var t,i;return{x:e.x,y:e.y,width:null!==(t=e.width)&&void 0!==t?t:this.nodeWidth,height:null!==(i=e.height)&&void 0!==i?i:this.nodeHeight}}addNodeGroup(e,t,i,s,n,o){e&&""!=e||(e=this.getUniqueName("group"));let r=new a(e,t,i,s,n,o);return this.nodeGroups.push(r),r}getNodeGroupByName(e){for(let t of this.nodeGroups)if(t.name==e)return t;return null}removeNodeGroup(e){let t=this.getNodeGroupByName(e);t&&this.nodeGroups.splice(this.nodeGroups.indexOf(t),1)}updateEditCanvas(e=null,t=null,i=null){var s,r,a,d,l;n.CanvasUtil.setCanvasSize(this.editCanvas,"100%",400),n.CanvasUtil.clearCanvas(this.editCanvasContext,this.backgroundColor),e&&(this.editMousePos=this.getEditMousePos(e)),this.editCanvasContext.scale(this.editCanvasScale,this.editCanvasScale),this.editCanvasContext.translate(this.editCanvasOffset.x,this.editCanvasOffset.y);let h={stinger:this.nodeHeight-6,segment:this.nodeHeight-6,outro:this.nodeHeight+3};for(let e of this.nodeGroups)this.drawGroupRect(e,!0);for(let e of this.nodes){let l=-1,u=this.isEditMouseOver(this.editMousePos,e.x,e.y,null!==(s=e.width)&&void 0!==s?s:this.nodeWidth,null!==(r=e.height)&&void 0!==r?r:this.nodeHeight),g=!1,m=!1;if(i&&i.activeEditNode==e&&(m=!0),t&&t.isPlaying){let i=t.currentSegments.indexOf(e.segment);i>-1?(u=!0,l=t.percentages[i]):e.segment===t.nextQueuedSegment&&(u=!0,g=!0)}let c=null!==(a=e.width)&&void 0!==a?a:this.nodeWidth,p=null!==(d=e.height)&&void 0!==d?d:this.nodeHeight;n.CanvasUtil.drawSegment(this.editCanvasContext,e.segment,l,e.x,e.y,c,p,!0,u,g,m?"#00FF00":null),e.widgets||(e.widgets=[],e.widgets.push({name:"delete",label:"x",bounds:{x:c-15,y:3,width:12,height:12}}),"stinger"!=e.segment.type&&e.widgets.push({name:"stinger",label:"s",bounds:{x:1,y:5,width:12,height:12,left:!0}}),"outro"!=e.segment.type&&e.widgets.push({name:"next",label:"n",bounds:{x:c-13,y:.5*p-6,width:12,height:12,right:!0}}),-1==["stinger","outro"].indexOf(e.segment.type)&&e.widgets.push({name:"outro",label:"o",bounds:{x:c-13,y:-15+p,width:12,height:12,right:!0}}));for(let t of e.widgets){let i=o.Util.localBounds(t,e),s=this.isEditMouseOver(this.editMousePos,i.x,i.y,i.width,i.height)?"#ffffff":"#cccccc";this.drawButton(this.editCanvasContext,i,t.label,10,s)}if(e.segment.stinger){let t=this.getNodeByName(e.segment.stinger);t&&(this.drawNodeConnection(this.editCanvasContext,t,e,"yellow",h.stinger),h.stinger+=3)}if(e.segment.next){let t=this.getNodeByName(e.segment.next);t&&(this.drawNodeConnection(this.editCanvasContext,e,t,"white",h.segment),h.segment+=3)}if(e.segment.outro){let t=this.getNodeByName(e.segment.outro);t&&(this.drawNodeConnection(this.editCanvasContext,e,t,"red",h.outro),h.outro+=3)}}if(i&&i.dragStartNode){let e=i.dragStartNode.x+this.nodeWidth,t=i.dragStartNode.y+.5*(null!==(l=i.dragStartNode.height)&&void 0!==l?l:this.nodeHeight)+i.dragStartYOffset,s=this.editMousePos.x,o=this.editMousePos.y;this.editCanvasContext.globalAlpha=.5,n.CanvasUtil.drawArrow(this.editCanvasContext,e,t,s,o,i.dragArrowColor,!1,10,this.nodeHeight),this.editCanvasContext.globalAlpha=1}i&&i.dragGroupRect&&this.drawGroupRect(i.dragGroupRect,!0)}drawGroupRect(e,t=!1){let i=o.Util.normalizeRect(e);this.editCanvasContext.fillStyle="#003f7f",this.editCanvasContext.strokeStyle="#007fff",this.editCanvasContext.globalAlpha=.5,n.CanvasUtil.roundRect(this.editCanvasContext,i.x,i.y,i.width,i.height,10,t),this.editCanvasContext.globalAlpha=1}drawNodeConnection(e,t,i,s,o=null){var r,a;let d=t.x+this.nodeWidth,l=t.y+.5*(null!==(r=t.height)&&void 0!==r?r:this.nodeHeight)+("outro"==i.segment.type?15:0),h=i.x,u=i.y+.5*(null!==(a=i.height)&&void 0!==a?a:this.nodeHeight)+("stinger"==t.segment.type?-15:0);n.CanvasUtil.drawArrow(e,d,l,h,u,null!=s?s:"white",!1,10,null!=o?o:this.nodeHeight)}drawButton(e,t,i,s,o=null){o=null!=o?o:"#ffffff",s=null!=s?s:12,e.fillStyle="#99bb00",e.strokeStyle="#bbff00",n.CanvasUtil.roundRect(e,t.x,t.y,t.width,t.height,5,!0,t.left,t.right),e.strokeStyle=o,e.fillStyle=o,e.font=s+"px Orbitron",e.fillText(i,t.x+s/4,t.y+.9*s)}zoomBy(e,t){this.editCanvasScale*=e;let i=t?this.getEditMousePos(t):{x:0,y:0},s=o.Util.scalePointBy(i,(1-e)/this.editCanvasScale);this.editCanvasOffset=o.Util.addPoints(this.editCanvasOffset,s),this.updateEditCanvas(t)}resetEditCanvasTransform(){this.editCanvasScale=1,this.editCanvasOffset={x:0,y:0},this.updateEditCanvas()}getUniqueName(e){let t=1;if("group"==e){for(;this.getNodeGroupByName(e+t);)t++;return e+t}}getEditMousePos(e){if(!e)return{x:0,y:0};let t=this.editCanvas.getBoundingClientRect();return this.editMousePos={x:e.clientX-t.x,y:e.clientY-t.y},this.editMousePos}isEditMouseOver(e,t,i,s,n){return!!e&&(e.x/this.editCanvasScale-this.editCanvasOffset.x>t&&e.x/this.editCanvasScale-this.editCanvasOffset.x<t+s&&e.y/this.editCanvasScale-this.editCanvasOffset.y>i&&e.y/this.editCanvasScale-this.editCanvasOffset.y<i+n)}};class r{constructor(e,t,i){this.segment=e,this.x=null!=t?t:0,this.y=null!=i?i:0}}t.EditorNode=r;class a{constructor(e,t,i,s,n,o){this.name=e,this.nodes=null!=t?t:[],this.x=null!=i?i:0,this.y=null!=s?s:0,this.width=null!=n?n:0,this.height=null!=o?o:0}addNode(e){-1==this.nodes.indexOf(e)&&this.nodes.push(e)}removeNode(e){this.nodes.indexOf(e)>-1&&this.nodes.splice(this.nodes.indexOf(e),1)}}return t.EditorNodeGroup=a,i.exports=t,i})),n.def("build/sequencer/sound.js",(function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SoundBank=t.SoundElement=void 0;class n{constructor(e,t){this.context=e,this.loaded=!1,this.log=t||console.log}loadFile(e,t,i,s){this.path=e,t||(t=e.replace(/.*\//g,"").replace(/\.[^.]*$/g,""));var n=new XMLHttpRequest;n.onload=()=>{this.log("  Loaded "+e+" as "+t+", decodeAudioData...");let o=n.response;this.context.decodeAudioData(o,(e=>{null!=e?(this.name=t,this.buffer=e,this.loaded=!0,i&&i(this)):this.log("ERROR: buffer is null!")}),(e=>{this.log("decode error!"),s(e)}))},n.onerror=e=>{s(e)},n.open("GET",e,!0),this.log("Opened request..."),n.responseType="arraybuffer",n.send(),this.log("Sent request...")}}t.SoundElement=n;return t.SoundBank=class{constructor(e,t){this.context=e,this.log=t||console.log,this.soundElements=new Map,this._soundsLoading=[]}loadSound(e,t,i,s){this.log("loadSound: "+e+" as "+t);let o=new n(this.context,this.log);this._soundsLoading.push(o),o?o.loadFile(e,t,(e=>{i(e)}),s):this.log("Error: sound not created (for name: "+t+")")}loadSounds(e,t,i,s){for(let n of e){let e,o;"string"==typeof n?(e=t+n,o=n):(e=t+n.file,o=n.name),this.loadSound(e,o,(e=>{this._soundLoaded(e,i,o)}),s)}}_soundLoaded(e,t,i){e||this.log("Error: sound undefined or null. Triggered for: "+i),this.log("Sound loaded: "+e.name);var s=this._soundsLoading.indexOf(e);-1!=s&&(this._soundsLoading.splice(s,1),this.soundElements.set(e.name,e)),this.allLoaded()&&t&&t()}allLoaded(){return this.log("all sounds loaded!"),0==this._soundsLoading.length}getSound(e){return this.soundElements.get(e)}getSoundByFile(e,t=!1){for(let i of this.soundElements.values()){if((t?i.path:i.path.replace(/.*\//g,""))==e)return i}return null}},i.exports=t,i})),n("build/main.js")}();
